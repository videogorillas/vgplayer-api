# Frame Accuracy and seeking behavior

See [Browser Limitations](#FrameAccuracy_browser) for general info on video playback in web browsers.

Section [Frame Accuracy](#FrameAccuracy_explained) explains what is frame accuracy in detail.

Section [Frame Accuracy Levels](#FrameAccuracy_levels) describes preconditions for frame accuracy.

## <a id="FrameAccuracy_browser"></a> Browser Limitations

The player relies on built-in browser media playback engine.
Obviously browser is optimized for typical usage scenarios.
Unfortunately accurate seeking is not what most users really need for watching kittens videos on youtube.
So browsers are NOT optimized for precise seeking.

Correct seeking to arbitrary time depends on browser implementation.
Sometimes it is impossible. Here are some examples:

- having B-frames in video stream will break any seeking accuracy for sure
- it is often impossible to seek to the last few frames. However you can reach them by playing the video to the end


## <a id="FrameAccuracy_explained"></a> Frame Accuracy

Note: Timeline calculation is any calculation involving frame numbers or timecodes.

What is frame accurate seeking/playback?

- ability to seek video to frame #12345 and see exactly frame #12345 on your screen
- ability to see a frame on the screen and know for sure it is frame #12345

The player implements a number of _hacks_ to address both points.
That is why you should always rely on [Timeline](Player.md#Player_getTimeline) class for timeline calculations.

This is a timeline scheme:
```
 vvvvv
|00000|11111|22222|33333|...  ---> time
 ^
```
- `|` - frame *start time*
- `1` - frame number in particular moment of time
- `^` - current playback position reported by browser
- `vvvvv` - the frame you see on the screen

Each frame has *start time* and *duration*. *Start time* plus *duration* is the *start time* of the next frame.
If all frame durations are equal we call it constant frame rate (CFR) as opposed to variable frame rate (VFR).

### Seeking to arbitrary frame number or timecode

When you ask the player to seek to a frame number (i.e. call `seekFrame()`) it tries to seek close to the frame *start time*:
```
       vvvvv
|00000|11111|22222|33333|...
       ^
```

### Seeking to arbitrary time

If you want to seek to arbitrary time expressed in seconds with `seekSec()` here are some tips.


Seeking to frame #1 can be like this:
```
       vvvvv
|00000|11111|22222|33333|...
       ^
```
or like this
```
       vvvvv
|00000|11111|22222|33333|...
          ^
```
In both cases you will to see frame #1 on the screen.

Never try to seek very close to frame end like on example below.
Minimum time remaining to the next frame *start time* should NOT be less than **0.001** seconds.
```
|00000|11111|22222|33333|...
           ^
```
Else you will end up seeing frame #2 rendered on the screen:
```
             vvvvv
|00000|11111|22222|33333|...
           ^
```
Which is not what you expect.

### Pausing

When you press pause or call `pause()` browser can behave like this:
```
             vvvvv
|00000|11111|22222|33333|...
         ^
```
It reports the video is positioned clearly within frame #1 duration BUT you see frame #2 rendered on the screen.
That is why you often see player goes back 1 frame after it pauses playback.


## <a id="FrameAccuracy_levels"></a> Frame Accuracy Levels

The player has 3 different levels of frame accurate operation. See appropriate sections:

- [frame accurate playback/seeking guaranteed](#FrameAccuracy_accurate)
- [frame accurate timeline calculations guaranteed](#FrameAccuracy_timeline)
- [frame accuracy is NOT guaranteed](#FrameAccuracy_generic)

### <a id="FrameAccuracy_accurate"></a> Frame accurate seeking/playback guaranteed

The player can guarantee frame accurate playback and seeking when ALL of these conditions are met:

- .mp4/.mov or DASH or VG Proxy
- video stream codec settings are as described in [Generic Proxy Spec](VGProxySpec.md#GenericProxy_Codec)

Additionally in case of .mp4/.mov file:

- CORS enabled
- Range requests enabled

Additionally in case of DASH:

- segment timeline in .mpd file
- frame information in .mpd file. Required only for VFR. Generated by Adapter.

### <a id="FrameAccuracy_timeline"></a> Frame accurate timeline calculations guaranteed

In some cases the player can guarantee correct timecodes and frame numbers calculations but NOT frame accurate seeking.
Timeline calculations will be correct if ALL of these conditions are met:

- .mp4/.mov file
- any codec that is supported by the browser
- CORS enabled
- Range requests enabled


### <a id="FrameAccuracy_generic"></a> No guarantees. Default/Generic playback

If timeline accuracy can not be guaranteed the player uses fallback loading method.
In that case you will see `loadGeneric()` in the console. HLS always loads this way.

Limitations of the method:

- number and type of audio tracks is unknown, assumed to be 2 channel stereo
- can not switch between audio tracks
- frame rate is unknown, assumed to be CFR 24000/1001. Timeline calculations are incorrect if video frame rate is not CFR 24000/1001.
